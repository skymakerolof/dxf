import fs from 'fs'
import { join } from 'path'
import expect from 'expect'

import { parseString, toPolylines } from '../../src'
const dxfContents = fs.readFileSync(join(__dirname, '/../resources/squareandcircle.dxf'), 'utf-8')

describe('DXF to coloured polylines', () => {
  it('for square and circle', () => {
    const parsed = parseString(dxfContents)
    const polylines = toPolylines(parsed)
    expect(polylines).toEqual({
      bbox: { max: { x: 10, y: 10 }, min: { x: 0, y: 0 } },
      polylines: [
        {
          rgb: [0, 0, 255],
          vertices: [[10, 5], [9.980973490458727, 5.435778713738291], [9.92403876506104, 5.868240888334651], [9.82962913144534, 6.294095225512604], [9.698463103929543, 6.710100716628343], [9.53153893518325, 7.113091308703497], [9.330127018922195, 7.5], [9.095760221444959, 7.86788218175523], [8.83022221559489, 8.213938048432697], [8.535533905932738, 8.535533905932738], [8.213938048432697, 8.83022221559489], [7.86788218175523, 9.095760221444959], [7.5, 9.330127018922193], [7.113091308703498, 9.53153893518325], [6.710100716628345, 9.69846310392954], [6.294095225512606, 9.82962913144534], [5.868240888334654, 9.92403876506104], [5.435778713738294, 9.980973490458727], [5.0000000000000036, 10], [4.564221286261713, 9.980973490458728], [4.131759111665353, 9.924038765061042], [3.705904774487401, 9.829629131445342], [3.289899283371662, 9.698463103929544], [2.8869086912965076, 9.531538935183253], [2.500000000000005, 9.330127018922195], [2.1321178182447746, 9.095760221444962], [1.7860619515673082, 8.830222215594894], [1.4644660940672671, 8.535533905932743], [1.169777784405115, 8.213938048432702], [0.9042397785550458, 7.8678821817552365], [0.6698729810778108, 7.500000000000008], [0.4684610648167542, 7.113091308703506], [0.30153689607046097, 6.710100716628353], [0.17037086855466121, 6.2940952255126135], [0.07596123493896201, 5.868240888334663], [0.019026509541273384, 5.435778713738302], [0, 5.0000000000000115], [0.019026509541271608, 4.564221286261722], [0.07596123493895757, 4.131759111665361], [0.170370868554655, 3.705904774487409], [0.30153689607045386, 3.2898992833716694], [0.46846106481674443, 2.886908691296516], [0.6698729810777992, 2.500000000000013], [0.9042397785550325, 2.132117818244782], [1.1697777844050998, 1.7860619515673153], [1.4644660940672507, 1.4644660940672738], [1.7860619515672922, 1.1697777844051194], [2.132117818244757, 0.9042397785550502], [2.4999999999999867, 0.6698729810778143], [2.886908691296488, 0.46846106481675687], [3.2898992833716405, 0.30153689607046363], [3.7059047744873794, 0.170370868554663], [4.131759111665331, 0.0759612349389629], [4.564221286261691, 0.019026509541274272], [4.999999999999981, 0], [5.435778713738272, 0.01902650954127072], [5.868240888334633, 0.07596123493895579], [6.294095225512584, 0.17037086855465322], [6.710100716628324, 0.3015368960704512], [7.113091308703478, 0.46846106481674177], [7.499999999999981, 0.6698729810777957], [7.8678821817552125, 0.904239778555028], [8.213938048432679, 1.169777784405095], [8.535533905932722, 1.4644660940672463], [8.830222215594876, 1.7860619515672846], [9.095760221444944, 2.1321178182447498], [9.33012701892218, 2.4999999999999782], [9.531538935183239, 2.8869086912964796], [9.698463103929534, 3.289899283371632], [9.829629131445333, 3.7059047744873705], [9.924038765061034, 4.131759111665322], [9.980973490458727, 4.564221286261682], [10, 4.999999999999999]]
        },
        {
          rgb: [255, 0, 0],
          vertices: [[0, 0], [10, 0], [10, 10], [0, 10], [0, 0]]
        }
      ]
    })
  })
})
